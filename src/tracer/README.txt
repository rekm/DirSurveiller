This is mostly thread handling logic
directly gotten from Linus Torvalds Perf Linux Tool
